<!DOCTYPE html>
<html lang="en" class="h-full scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>PUBLIC_ARCHIVE // COOKED - LIFE</title>

		<!-- Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Syne:wght@400;500;600;700;800&family=JetBrains+Mono:wght@100;200;300;400;500;600;700;800&family=DM+Sans:opsz,wght@9..40,100..1000&display=swap" rel="stylesheet" />

		<!-- Tailwind & Config -->
		<script src="https://cdn.tailwindcss.com"></script>
		<script>
			tailwind.config = {
				darkMode: "class",
				theme: {
					extend: {
						fontFamily: {
							sans: ["DM Sans", "sans-serif"],
							mono: ["JetBrains Mono", "monospace"],
							display: ["Syne", "sans-serif"],
							grotesk: ["Space Grotesk", "sans-serif"],
						},
						colors: {
							obsidian: "#030305",
							midnight: "#0A0A0F",
							electric: "#3B82F6",
							cyber: "#8B5CF6",
							acid: "#CCFF00",
							glass: "rgba(255, 255, 255, 0.03)",
							"glass-border": "rgba(255, 255, 255, 0.08)",
						},
						backgroundImage: {
							"gradient-radial": "radial-gradient(var(--tw-gradient-stops))",
							noise: "url('data:image/svg+xml,%3Csvg viewBox=%220 0 200 200%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cfilter id=%22noiseFilter%22%3E%3CfeTurbulence type=%22fractalNoise%22 baseFrequency=%220.65%22 numOctaves=%223%22 stitchTiles=%22stitch%22/%3E%3C/filter%3E%3Crect width=%22100%25%22 height=%22100%25%22 filter=%22url(%23noiseFilter)%22 opacity=%220.05%22/%3E%3C/svg%3E')",
						},
						animation: {
							"pulse-slow": "pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite",
							float: "float 6s ease-in-out infinite",
							marquee: "marquee 25s linear infinite",
						},
						keyframes: {
							float: {
								"0%, 100%": { transform: "translateY(0)" },
								"50%": { transform: "translateY(-10px)" },
							},
							marquee: {
								"0%": { transform: "translateX(0)" },
								"100%": { transform: "translateX(-100%)" },
							},
						},
					},
				},
			};
		</script>
		<style>
			.glass-panel {
				background: rgba(255, 255, 255, 0.03);
				backdrop-filter: blur(10px);
				border: 1px solid rgba(255, 255, 255, 0.08);
			}
			body {
				background-color: #030305;
				color: #e2e8f0;
			}
			/* Custom Scrollbar */
			::-webkit-scrollbar {
				width: 8px;
			}
			::-webkit-scrollbar-track {
				background: #0a0a0f;
			}
			::-webkit-scrollbar-thumb {
				background: #333;
				border-radius: 4px;
			}
			::-webkit-scrollbar-thumb:hover {
				background: #555;
			}
		</style>
		<script src="./config.js"></script>
	</head>
	<body class="min-h-full bg-obsidian text-slate-200 selection:bg-electric selection:text-white overflow-x-hidden">
		<!-- Noise Overlay -->
		<div class="fixed inset-0 bg-noise opacity-20 -z-10 pointer-events-none"></div>

		<!-- Navbar -->
		<nav class="fixed top-0 left-0 right-0 z-50 border-b border-white/5 bg-obsidian/80 backdrop-blur-md">
			<div class="max-w-7xl mx-auto px-4 sm:px-6 h-16 sm:h-20 flex items-center justify-between">
				<div class="flex items-center gap-2">
					<div class="w-2 h-2 bg-electric rounded-full animate-pulse"></div>
					<a href="./"><span class="font-display font-bold text-xl tracking-tighter">COOKED - LIFE</span></a>
				</div>

				<!-- Desktop Menu -->
				<div class="hidden md:flex items-center gap-8 font-mono text-sm text-slate-400">
					<a href="./" class="hover:text-white transition-colors">TERMINAL</a>
					<a href="./public.html" class="hover:text-white transition-colors">ARCHIVE</a>
					<a href="https://github.com/SpreadSheets600/Cooked-Roasted-Life" target="_blank" class="hover:text-white transition-colors">SOURCE</a>
				</div>

				<!-- Mobile Menu Button -->
				<button id="mobile-menu-btn" class="md:hidden text-white p-2">
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<line x1="3" y1="12" x2="21" y2="12"></line>
						<line x1="3" y1="6" x2="21" y2="6"></line>
						<line x1="3" y1="18" x2="21" y2="18"></line>
					</svg>
				</button>
			</div>

			<!-- Mobile Menu -->
			<div id="mobile-menu" class="hidden md:hidden border-t border-white/5 bg-obsidian/95 backdrop-blur-xl">
				<div class="flex flex-col p-6 gap-4 font-mono text-sm text-slate-400">
					<a href="./" class="hover:text-white transition-colors py-2">TERMINAL</a>
					<a href="./public.html" class="hover:text-white transition-colors py-2">ARCHIVE</a>
					<a href="https://github.com/SpreadSheets600/Cooked-Roasted-Life" target="_blank" class="hover:text-white transition-colors py-2">SOURCE</a>
				</div>
			</div>
		</nav>

		<script>
			const mobileMenuBtn = document.getElementById("mobile-menu-btn");
			const mobileMenu = document.getElementById("mobile-menu");
			if (mobileMenuBtn && mobileMenu) {
				mobileMenuBtn.addEventListener("click", () => {
					mobileMenu.classList.toggle("hidden");
				});
			}
		</script>

		<main class="pt-24 sm:pt-32 pb-16 sm:pb-20 px-4 sm:px-6">
			<section class="max-w-7xl mx-auto space-y-10 sm:space-y-12">
				<div class="flex flex-col md:flex-row justify-between items-end gap-4 sm:gap-6 border-b border-white/5 pb-6 sm:pb-8">
					<div>
						<h1 class="font-display font-bold text-3xl sm:text-4xl md:text-6xl mb-1 sm:mb-2">PUBLIC_ARCHIVE</h1>
						<p class="font-mono text-slate-400 text-sm sm:text-base">Global database of roasted entities.</p>
					</div>
				</div>

				<div id="public-roasts-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
					<div class="col-span-full text-center py-20 font-mono text-slate-500 animate-pulse">INITIALIZING DATA STREAM...</div>
				</div>

				<div id="load-more" class="text-center hidden pt-6 sm:pt-8">
					<button class="px-6 sm:px-8 py-2.5 sm:py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-full font-mono text-xs sm:text-sm text-white transition-all">LOAD_MORE_DATA</button>
				</div>
			</section>
		</main>

		<!-- Footer -->
		<footer class="border-t border-white/5 bg-black/50 backdrop-blur-sm pt-20 pb-10 overflow-hidden">
			<div class="mb-16 relative">
				<div class="absolute inset-0 bg-gradient-to-r from-obsidian via-transparent to-obsidian z-10 pointer-events-none"></div>
				<div class="animate-marquee whitespace-nowrap flex gap-8 text-[12vw] font-display font-black text-white/5 leading-none select-none pointer-events-none">
					<span>COOKED BY AI</span>
					<span>•</span>
					<span>ULTIMATE DIGITAL ROAST</span>
					<span>•</span>
					<span>COOKED - LIFE</span>
					<span>•</span>
					<span>COOKED BY AI</span>
				</div>
			</div>
			<div class="max-w-7xl mx-auto px-6">
				<div class="flex flex-col md:flex-row justify-between items-center gap-6">
					<div class="text-center md:text-left">
						<h4 class="font-display font-bold text-2xl mb-2">COOKED - LIFE</h4>
						<p class="text-slate-500 font-mono text-sm">AI-POWERED PERSONALITY DECONSTRUCTION</p>
					</div>
					<div class="flex gap-6">
						<a href="#" class="text-slate-400 hover:text-white transition-colors">GITHUB</a>
					</div>
				</div>
				<div class="mt-12 pt-8 border-t border-white/5 text-center">
					<p class="font-mono text-xs text-slate-600">SYSTEM VERSION 2.0 // BUILD 2025 // SpreadSheets600</p>
				</div>
			</div>
		</footer>

		<script>
			let currentPage = 1;
			let isLoading = false;
			const API_BASE = ((window.API_BASE || window.location.origin) || "").replace(/\/$/, "");

			function formatDate(iso) {
				const date = new Date(iso);
				if (Number.isNaN(date.getTime())) return "--";
				return date.toLocaleDateString("en-US", { month: "short", day: "numeric", hour: "2-digit", minute: "2-digit" });
			}

			function formatInputs(inputs = {}) {
				const badges = [];
				if (inputs.spotify_name) badges.push('<span class="px-2 py-0.5 rounded bg-green-500/10 text-green-400 text-[10px] border border-green-500/20 font-mono">SPOTIFY</span>');
				if (inputs.valorant_name) badges.push('<span class="px-2 py-0.5 rounded bg-red-500/10 text-red-400 text-[10px] border border-red-500/20 font-mono">VALORANT</span>');
				if (inputs.anilist_user) badges.push('<span class="px-2 py-0.5 rounded bg-blue-500/10 text-blue-400 text-[10px] border border-blue-500/20 font-mono">ANILIST</span>');
				if (inputs.steam_id || inputs.steam_vanity) badges.push('<span class="px-2 py-0.5 rounded bg-slate-500/10 text-slate-400 text-[10px] border border-slate-500/20 font-mono">STEAM</span>');
				return badges.join(" ");
			}

			async function loadPublicRoasts(page = 1) {
				if (isLoading) return;
				const list = document.getElementById("public-roasts-list");
				const loadMore = document.getElementById("load-more");
				const loadMoreBtn = loadMore?.querySelector("button");

				if (page === 1) {
					list.innerHTML = '<div class="col-span-full text-center py-20 font-mono text-slate-500 animate-pulse">INITIALIZING DATA STREAM...</div>';
				}
				isLoading = true;

				try {
					const res = await fetch(`${API_BASE}/api/roast/public?page=${page}`, {
						credentials: "include",
					});
					if (!res.ok) throw new Error(`Request failed with ${res.status}`);
					const data = await res.json();

					if (page === 1) list.innerHTML = "";

					if (!data.roasts || data.roasts.length === 0) {
						if (page === 1) list.innerHTML = '<div class="col-span-full text-center py-20 font-mono text-slate-500">NO DATA FOUND IN ARCHIVE.</div>';
						loadMore.classList.add("hidden");
						return;
					}

					data.roasts.forEach((r) => {
						const div = document.createElement("div");

						div.className = "glass-panel p-5 sm:p-6 rounded-xl cursor-pointer hover:border-electric/50 transition-all group flex flex-col h-full";
						div.onclick = () => (window.location.href = `./view.html?id=${r.id}`);
						const inputsMarkup = formatInputs(r.inputs || {});

						div.innerHTML = `
                        <div class="flex justify-between items-start mb-4 border-b border-white/5 pb-2">
                            <span class="font-mono text-xs text-electric tracking-widest">ROAST #${r.id.substring(0, 6)}</span>
                            <span class="font-mono text-xs text-slate-500">${formatDate(r.timestamp)}</span>
                        </div>
                        <p class="font-mono text-sm text-slate-400 line-clamp-3 group-hover:text-slate-200 transition-colors flex-grow mb-4">${r.roast}</p>
                        ${inputsMarkup ? `<div class="flex flex-wrap gap-2">${inputsMarkup}</div>` : ""}
                    `;
						list.appendChild(div);
					});

					const hasNext = typeof data.has_next !== "undefined" ? data.has_next : (data.page || page) < (data.pages || page);
					if (hasNext) {
						loadMore.classList.remove("hidden");
						if (loadMoreBtn) {
							loadMoreBtn.disabled = false;
							loadMoreBtn.onclick = () => loadPublicRoasts(page + 1);
						}
					} else {
						loadMore.classList.add("hidden");
						if (loadMoreBtn) loadMoreBtn.onclick = null;
					}
					currentPage = page;
				} catch (err) {
					list.innerHTML = '<div class="col-span-full text-center py-20 font-mono text-red-500">SYSTEM ERROR: CONNECTION LOST.</div>';
					loadMore.classList.add("hidden");
				} finally {
					isLoading = false;
				}
			}

			document.addEventListener("DOMContentLoaded", () => {
				loadPublicRoasts();
			});
		</script>
	</body>
</html>
